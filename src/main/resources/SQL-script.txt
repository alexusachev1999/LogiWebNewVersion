CREATE DATABASE logiWeb;
alter database logiWeb character set utf8;
USE logiWeb;

CREATE TABLE logiWeb.cities (
                                id int NOT NULL AUTO_INCREMENT,
                                name varchar(30) NOT NULL,
                                PRIMARY KEY (id)
);

CREATE TABLE logiWeb.map (
                             id int NOT NULL AUTO_INCREMENT,
                             city1_id int,
                             city2_id int,
                             distance int,
                             PRIMARY KEY (id),
                             FOREIGN KEY (city1_id) REFERENCES logiWeb.cities(id),
                             FOREIGN KEY (city2_id) REFERENCES logiWeb.cities(id)
);

CREATE TABLE users (
                       username varchar(15),
                       password varchar(100),
                       enabled tinyint(1),
                       PRIMARY KEY (username)
) ;

CREATE TABLE authorities (
                             id int AUTO_INCREMENT NOT NULL,
                             username varchar(15),
                             authority varchar(25),
                             PRIMARY KEY (id),
                             FOREIGN KEY (username) references users(username)
) ;

CREATE TABLE logiWeb.cargo (
                               id int NOT NULL AUTO_INCREMENT,
                               number int,
                               name varchar(50),
                               weight int,
                               status varchar(15),
                               PRIMARY KEY (id)
);

CREATE TABLE logiWeb.truck (
                               id int NOT NULL AUTO_INCREMENT,
                               registration_number varchar(7),
                               driver_shift_duration int,
                               state bool DEFAULT true,
                               city_id int,
                               capacity int,
                               PRIMARY KEY (id),
                               FOREIGN KEY (city_id) REFERENCES logiWeb.cities(id)
);

CREATE TABLE logiWeb.orders (
                                id int NOT NULL AUTO_INCREMENT,
                                number int,
                                status bool DEFAULT false,
                                truck_id int,
                                PRIMARY KEY (id),
                                FOREIGN KEY (truck_id) REFERENCES logiWeb.truck(id)
);

CREATE TABLE logiWeb.driver (
                                id int NOT NULL AUTO_INCREMENT,
                                status varchar(15),
                                city_id int,
                                truck_id int,
                                order_id int,
                                username varchar(15),
                                name varchar(20),
                                surname varchar(20),
                                phone_number varchar(16),
                                worked_hours int,
                                PRIMARY KEY (id),
                                FOREIGN KEY (truck_id) REFERENCES logiWeb.truck(id),
                                FOREIGN KEY (order_id) REFERENCES logiWeb.orders(id),
                                FOREIGN KEY (city_id) REFERENCES logiWeb.cities(id),
                                FOREIGN KEY (username) REFERENCES logiWeb.users(username)
);

CREATE TABLE logiWeb.waypoint (
                                  id int NOT NULL AUTO_INCREMENT,
                                  city_loading_id int,
                                  city_unloading_id int,
                                  cargo_id int,
                                  order_id int,
                                  PRIMARY KEY (id),
                                  FOREIGN KEY (cargo_id) REFERENCES logiWeb.cargo(id),
                                  FOREIGN KEY (order_id) REFERENCES logiWeb.orders(id),
                                  FOREIGN KEY (city_loading_id) REFERENCES logiWeb.cities(id),
                                  FOREIGN KEY (city_unloading_id) REFERENCES logiWeb.cities(id)
);

ALTER TABLE logiWeb.cities CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.authorities CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.driver CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.truck CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.orders CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.waypoint CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.map CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.users CONVERT TO CHARACTER SET utf8;
ALTER TABLE logiWeb.cargo CONVERT TO CHARACTER SET utf8;

insert cities (id, name) value (1, 'Санкт-Петербург');
insert cities (id, name) value (2, 'Москва');
insert cities (id, name) value (3, 'Ростов');
insert cities (id, name) value (4, 'Краснодар');
insert cities (id, name) value (5, 'Сочи');




INSERT INTO users (username, password, enabled)
VALUES
('alex', '{noop}1234', 1),
('misha', '{noop}1234', 1);

INSERT INTO authorities (username, authority)
VALUES
('alex', 'ROLE_ADMIN'),
('misha', 'ROLE_DRIVER');
